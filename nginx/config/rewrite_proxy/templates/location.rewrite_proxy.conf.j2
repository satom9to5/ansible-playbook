location {{ nginx_config_rewrite_proxy_location }} {
    rewrite ^{{ nginx_config_rewrite_proxy_location }}/(.*) /$1 break;

    try_files $uri @{{ nginx_config_rewrite_proxy_config_name }};
{% if nginx_config_rewrite_proxy_root is defined and nginx_config_rewrite_proxy_root != "" %}
    root {{ nginx_config_rewrite_proxy_root }};
{% endif %}
}

location @{{ nginx_config_rewrite_proxy_config_name }} {
    proxy_pass     http://@{{ nginx_config_rewrite_proxy_upstream }}$uri$is_args$query_string;
    proxy_redirect / $scheme://$http_host{{ nginx_config_rewrite_proxy_location }}/;
}
