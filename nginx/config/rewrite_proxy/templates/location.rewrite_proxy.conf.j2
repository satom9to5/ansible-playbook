location /{{ nginx_config_rewrite_proxy_location }} {
    try_files $uri $uri/ @{{ nginx_config_rewrite_proxy_location }};
{% if nginx_config_rewrite_proxy_root is defined and nginx_config_rewrite_proxy_root != "" %}
    root {{ nginx_config_rewrite_proxy_root }};
{% endif %}
}

location @{{ nginx_config_rewrite_proxy_location }} {
    rewrite ^{{ nginx_config_rewrite_proxy_location }}/(.+) $1 break;

    proxy_pass     http://@{{ nginx_config_rewrite_proxy_upstream }}/$1;
    proxy_redirect / $scheme://$http_host/{{ nginx_config_rewrite_proxy_location }}/;
}
