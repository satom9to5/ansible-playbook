- name: goofys s3 bucket mount
  tags:
    - golang
    - golang/package/goofys
    - golang/package/goofys/mount
  when: goofys_s3_bucket != "" and goofys_s3_path != ""
  shell: |
    source /etc/profile.d/proglang.sh
    {{ gopath }}/bin/goofys {{ goofys_s3_bucket }} {{ goofys_s3_path }}

- name: check goofys s3 bucket fstab setting
  tags:
    - golang
    - golang/package/goofys
    - golang/package/goofys/mount
  when: goofys_s3_bucket != "" and goofys_s3_path != "" and goofys_fstab == true
  shell: grep goofys /etc/fstab
  register: goofys_fstab_setting_result
  failed_when: goofys_fstab_setting_result.rc not in [0,1]

- name: add goofys s3 bucket fstab setting
  tags:
    - golang
    - golang/package/goofys
    - golang/package/goofys/mount
  become: true
  when: goofys_s3_bucket != "" and goofys_s3_path != "" and goofys_fstab == true and goofys_fstab_setting_result.rc != 0
  shell: |
    echo "goofys#{{ goofys_s3_bucket }}   {{ goofys_s3_path }}      fuse _netdev,allow_other,--file-mode=0666    0       0" >> /etc/fstab
